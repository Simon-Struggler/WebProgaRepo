{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ—Ä–æ–¥—ã –∫–æ—à–µ–∫</title>
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .vote-container {
            margin-top: 10px;
        }
        .vote-btn {
            background: none;
            border: 1px solid #ddd;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        .vote-btn.active {
            background-color: #f0f0f0;
        }
        .like-btn.active {
            color: green;
        }
        .dislike-btn.active {
            color: red;
        }
        .vote-count {
            margin-left: 5px;
            font-weight: bold;
            color: black;
        }
    </style>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="{% url 'index' %}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="{% url 'breeds' %}">–ü–æ—Ä–æ–¥—ã</a></li>
                <li><a href="{% url 'care' %}">–£—Ö–æ–¥</a></li>
                {% if user.is_authenticated %}
                <li><a href="{% url 'logout' %}">–í—ã–π—Ç–∏</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    <main>
        <h1>–ü–æ—Ä–æ–¥—ã –∫–æ—à–µ–∫</h1>
        <p>–ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –Ω–∞–π–¥–µ—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø–æ—Ä–æ–¥–∞—Ö –∫–æ—à–µ–∫.</p>
        <div class="breed-card" data-breed="–ú–µ–π–Ω-–∫—É–Ω">
            <h2>–ú–µ–π–Ω-–∫—É–Ω</h2>
            <img src="{% static 'images/cat1.jpg' %}" alt="–ú–µ–π–Ω-–∫—É–Ω">
            <p>–ö—Ä—É–ø–Ω–∞—è –ø–æ—Ä–æ–¥–∞ –∫–æ—à–µ–∫, –∏–∑–≤–µ—Å—Ç–Ω–∞—è —Å–≤–æ–∏–º –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.</p>
            <div class="vote-container">
                <button class="vote-btn like-btn" data-action="like">
                    üëç <span class="vote-count like-count">0</span>
                </button>
                <button class="vote-btn dislike-btn" data-action="dislike">
                    üëé <span class="vote-count dislike-count">0</span>
                </button>
            </div>
        </div>
        <div class="breed-card" data-breed="–°–∏–∞–º—Å–∫–∞—è">
            <h2>–°–∏–∞–º—Å–∫–∞—è</h2>
            <img src="{% static 'images/cat2.jpg' %}" alt="–°–∏–∞–º—Å–∫–∞—è">
            <p>–≠–ª–µ–≥–∞–Ω—Ç–Ω–∞—è –∫–æ—à–∫–∞ —Å —è—Ä–∫–∏–º –æ–∫—Ä–∞—Å–æ–º –∏ –≥–æ–ª—É–±—ã–º–∏ –≥–ª–∞–∑–∞–º–∏.</p>
            <div class="vote-container">
                <button class="vote-btn like-btn" data-action="like">
                    üëç <span class="vote-count like-count">0</span>
                </button>
                <button class="vote-btn dislike-btn" data-action="dislike">
                    üëé <span class="vote-count dislike-count">0</span>
                </button>
            </div>
        </div>
        <div class="breed-card" data-breed="–ë—Ä–∏—Ç–∞–Ω—Å–∫–∞—è">
            <h2>–ë—Ä–∏—Ç–∞–Ω—Å–∫–∞—è</h2>
            <img src="{% static 'images/cat3.jpg' %}" alt="–ë—Ä–∏—Ç–∞–Ω—Å–∫–∞—è">
            <p>–ö–æ—à–∫–∞ —Å –ø–ª—é—à–µ–≤–æ–π —à–µ—Ä—Å—Ç—å—é –∏ —Å–ø–æ–∫–æ–π–Ω—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.</p>
            <div class="vote-container">
                <button class="vote-btn like-btn" data-action="like">
                    üëç <span class="vote-count like-count">0</span>
                </button>
                <button class="vote-btn dislike-btn" data-action="dislike">
                    üëé <span class="vote-count dislike-count">0</span>
                </button>
            </div>
        </div>
    <footer>
        <p>&copy; 2025 –ü–æ—Ä—Ç–∞–ª –æ –∫–æ—à–∫–∞—Ö</p>
    </footer>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –≥–æ–ª–æ—Å–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.breed-card').forEach(card => {
                const breedName = card.dataset.breed;
                fetch(`/get_likes/?breed_name=${encodeURIComponent(breedName)}`)
                    .then(response => response.json())
                    .then(data => {
                        card.querySelector('.like-count').textContent = data.likes;
                        card.querySelector('.dislike-count').textContent = data.dislikes;
                    });
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º
            document.querySelectorAll('.vote-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const card = this.closest('.breed-card');
                    const breedName = card.dataset.breed;
                    const action = this.dataset.action;

                    fetch('/like_breed/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'X-CSRFToken': getCookie('csrftoken')
                        },
                        body: `breed_name=${encodeURIComponent(breedName)}&action=${action}`
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                            card.querySelector('.like-count').textContent = data.likes;
                            card.querySelector('.dislike-count').textContent = data.dislikes;

                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
                            const likeBtn = card.querySelector('.like-btn');
                            const dislikeBtn = card.querySelector('.dislike-btn');

                            likeBtn.classList.remove('active');
                            dislikeBtn.classList.remove('active');

                            if (data.user_vote === 1) {
                                likeBtn.classList.add('active');
                            } else if (data.user_vote === -1) {
                                dislikeBtn.classList.add('active');
                            }
                        }
                    });
                });
            });

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });
        </script>
</body>
</html>